使用手机号码为key，防止重叠
value为验证码


String结构保存：JSON字符串，每个字段不独立

Hash结构，**内存占用更少**，每个字段独立存储，可以针对单个字段做CRUD（优化的角度考虑）

---

- 不能使用手机号，返回给前端，不太安全
- 以随机Token为key存储用户数据，作为登录凭证


---

基于Redis实现短信登录

代替session需要考虑的问题：
- 选择合适的数据结构
- 选择合适的key
- 选择合适的存储粒度

---

登录拦截器的优化

原来：
1. 获取token
2. 查询Redis用户
    - 不存在，则拦截
    - 存在，则继续
3. 保存到ThreadLocal
4. 刷新token有效期
5. 放行

拦截需要登录的路径

新增一个拦截器在这个之前

拦截一切路径

第一个
1. 获取token
2. 查询Redis的用户
3. 保存到ThreadLocal
4. 刷新token有效期
5. 放行

第二个

查询ThreadLocal的用户
- 不存在，则拦截
- 存在，则继续

手机 ——> 拦截器1：Token刷新拦截器 ——> 拦截器2：登录拦截器 ——> 运行Controller